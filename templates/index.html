$def with (data)

$var title: WindowDraw.

<!-- <div class="row clearfix">
	<div class="col-md-12 column">
 -->		
		<canvas id="myCanvas" resize="true">
			
		</canvas>
		<hr/>
		<canvas id="drawCanvas" resize="true">
			
		</canvas>


<!-- 		<script type="text/paperscript" canvas="myCanvas">
			// Create a Paper.js Path to draw a line into it:

			var path = new Path();
			// Give the stroke a color
			path.strokeColor = 'black';
			var start = new Point(100, 100);
			// Move to start and draw a line from there
			path.moveTo(start);
			// Note the plus operator on Point objects.
			// PaperScript does that for us, and much more!
			path.lineTo(start + [ 100, -50 ]);


			// This function is called whenever the user
			// clicks the mouse in the view:

		</script>
 -->
	 	<script type="text/javascript">
	 		function send_path(path) {
	 			$$.post('/',path);
	 		}
		// Only executed our code once the DOM is ready.


			window.onload = function() {

				// Get a reference to the canvas object
				var canvas = document.getElementById('drawCanvas');
				// Create an empty project and a view for the canvas:
				paper.setup(canvas);
				with (paper) {
					var source = new EventSource("/sse");
					source.onmessage = function(event) {
					    console.log("server update: " + event.data);
					    var path = Path.importJSON(event.data);
					    path.strokeColor = 'red';
					    console.log("path: " + path.segments);
					    view.draw();
					};
				}



				// Get a reference to the canvas object
				var canvas = document.getElementById('myCanvas');
				// Create an empty project and a view for the canvas:
				paper.setup(canvas);
				with (paper) {
					// Create a simple drawing tool:
					var tool = new Tool();
					var path;

					// Define a mousedown and mousedrag handler
					tool.onMouseDown = function(event) {
						path = new Path();
						path.strokeColor = 'black';
						path.add(event.point);
					}

					tool.onMouseDrag = function(event) {
						path.add(event.point);
					}

					tool.onMouseUp = function(event) {
						console.log("send path");
						var data = {};
						data['path'] = path.exportJSON()
						send_path(data);
					}


				}
			}
		</script>

<!-- 	</div>
</div>
 -->